<section class="form__section" [formGroup]="formGroup">
  <h2 class="form__heading">Упаковка:</h2>
  <div *ngIf="boxes.length" class="form__fieldset form__fieldset--package" formArrayName="boxes">
    <div class="form__fieldset-label">Коробка</div>
    <ng-container *ngFor="let itemGroup of boxes.controls; let i = index">
      <div class="form__field" [formGroupName]="i">
        <ng-container
          *ngFor="let control of formUtils.getGroupControls(itemGroup)  | keyvalue: formUtils.originalOrder;">
          <ng-container *ngIf="control.key === FormControlName.Counter; else checkbox">
            value: {{ control.value.value }}
            <app-package-modal
              *ngIf="activeCheckboxId === getId(i, boxes.controls)"
              [formControlName]="control.key"
              (close)="closeModal(i)"
              (ok)="changeControlState(getCheckboxControl(i, boxes.controls), control.value.value)"
            >
            </app-package-modal>
          </ng-container>
          <ng-template #checkbox>
            <app-checkbox [formControlName]="control.key" (change)="setActiveCheckbox(control.key); disableCheckbox(control.value)">
              <div class="text">{{formattedData[control.key].site_name}}</div>
              <div class="meta">{{formattedData[control.key].price}} руб за 1 шт.</div>
            </app-checkbox>
          </ng-template>
        </ng-container>
      </div>
    </ng-container>
  </div>
  <div *ngIf="savePacks.length" class="form__fieldset form__fieldset--package" formArrayName="save-packs">
    <div class="form__fieldset-label">Сейв-пакет</div>
    <ng-container *ngFor="let itemGroup of savePacks.controls; let i = index">
      <div class="form__field" [formGroupName]="i">
        <ng-container
          *ngFor="let control of formUtils.getGroupControls(itemGroup)  | keyvalue: formUtils.originalOrder;
          let controlIndex = index;">
          <ng-container *ngIf="control.key === FormControlName.Counter; else checkbox">
            <app-package-modal
              *ngIf="activeCheckboxId === getId(i, savePacks.controls)"
              [formControlName]="control.key"
              (close)="closeModal(i)"
            >
            </app-package-modal>
          </ng-container>
          <ng-template #checkbox>
            <app-checkbox [formControlName]="control.key" (change)="setActiveCheckbox(control.key)">
              <div class="text">{{formattedData[control.key].site_name}}</div>
              <div class="meta">{{formattedData[control.key].price}} руб за 1 шт.</div>
            </app-checkbox>
          </ng-template>
        </ng-container>
      </div>
    </ng-container>
  </div>
  <div *ngIf="plasticPacks.length" class="form__fieldset form__fieldset--package" formArrayName="plastic-packs">
    <div class="form__fieldset-label">Пластиковый пакет</div>
    <ng-container *ngFor="let itemGroup of plasticPacks.controls; let i = index">
      <div class="form__field" [formGroupName]="i">
        <ng-container
          *ngFor="let control of formUtils.getGroupControls(itemGroup)  | keyvalue: formUtils.originalOrder;
          let controlIndex = index;">
          <ng-container *ngIf="control.key === FormControlName.Counter; else checkbox">
            <app-package-modal
              *ngIf="activeCheckboxId === getId(i, plasticPacks.controls)"
              [formControlName]="control.key"
              (close)="closeModal(i)"
            >
            </app-package-modal>
          </ng-container>
          <ng-template #checkbox>
            <app-checkbox [formControlName]="control.key" (change)="setActiveCheckbox(control.key)">
              <div class="text">{{formattedData[control.key].site_name}}</div>
              <div class="meta">{{formattedData[control.key].price}} руб за 1 шт.</div>
            </app-checkbox>
          </ng-template>
        </ng-container>
      </div>
    </ng-container>
  </div>
  <div *ngIf="skins.length" class="form__fieldset form__fieldset--package" formArrayName="skins">
    <div class="form__fieldset-label">Пленка</div>
    <ng-container *ngFor="let itemGroup of skins.controls; let i = index">
      <div class="form__field" [formGroupName]="i">
        <ng-container
          *ngFor="let control of formUtils.getGroupControls(itemGroup)  | keyvalue: formUtils.originalOrder;
          let controlIndex = index;">
          <ng-container *ngIf="control.key === FormControlName.Counter; else checkbox">
            <app-package-modal
              *ngIf="activeCheckboxId === getId(i, skins.controls)"
              [formControlName]="control.key"
              (close)="closeModal(i)"
            >
            </app-package-modal>
          </ng-container>
          <ng-template #checkbox>
            <app-checkbox [formControlName]="control.key" (change)="setActiveCheckbox(control.key)">
              <div class="text">{{formattedData[control.key].site_name}}</div>
              <div class="meta">{{formattedData[control.key].price}} руб за 1 м.</div>
            </app-checkbox>
          </ng-template>
        </ng-container>
      </div>
    </ng-container>
  </div>
  <div *ngIf="other.length" class="form__fieldset form__fieldset--package" formArrayName="other">
    <div class="form__fieldset-label">Другое</div>
    <ng-container *ngFor="let itemGroup of other.controls; let i = index">
      <div class="form__field" [formGroupName]="i">
        <ng-container
          *ngFor="let control of formUtils.getGroupControls(itemGroup)  | keyvalue: formUtils.originalOrder;
          let controlIndex = index;">
          <ng-container *ngIf="control.key === FormControlName.Counter; else checkbox">
            <app-package-modal
              *ngIf="activeCheckboxId === getId(i, other.controls)"
              [formControlName]="control.key"
              (close)="closeModal(i)"
            >
            </app-package-modal>
          </ng-container>
          <ng-template #checkbox>
            <app-checkbox [formControlName]="control.key" (change)="setActiveCheckbox(control.key)">
              <div class="text">{{formattedData[control.key].site_name}}</div>
              <div class="meta">{{formattedData[control.key].price}} руб за 1шт.</div>
            </app-checkbox>
          </ng-template>
        </ng-container>
      </div>
    </ng-container>
  </div>
</section>
